<!DOCTYPE html>
<html lang="en">

<head>
    <title>Gallery of Glosses</title>
    <link rel="stylesheet" href="css/gloss.css">
    <link href="favicon.ico" rel="icon" type="image/x-icon" />
    <script src="/js/auth.js" type="module"></script>
    <script src="js/deer.js" type="module"></script>
    <script src="js/app.js" type="module"></script>
    <script src="js/shared.js"></script>
    <script src="js/lineSelector.js"></script>
</head>

<body class="container">
    <gog-header class="container"></gog-header>
    <h2> Named Gloss Textual Witness </h2>

    <p> Connect Named Glosses with text in T-PEN Transcriptions. </p>

    <div id="needs" class="row">
        <p class="howTo"> 
            It looks like you haven't provided a TPEN Manifest URI.  If you are not using the <code>?tpen-project=</code> URL parameter, you can supply a URI here.  
            <input id="resourceURI" type="text"/>
            <input id="loadInput" type="button" onclick="loadURI(event)" value="Load TPEN Manifest" />
        </p>
    </div>

    <deer-form class="needed is-hidden" deer-type="Text" deer-context="http://purl.org/dc/terms"> 
        <input is="auth-creator" type="hidden" deer-key="creator" />
        <div class="row">
            <label class="col-3 col-2-md text-right">Shelfmark:</label>
            <input type="text" deer-key-todo="shelfmark" placeholder="Label" class="col-9 col-10-md">
            <label class="col-3 col-2-md text-right">Digital Locations:</label>
            <input type="text" deer-key-todo="uri" class="col-9 col-10-md">

            <label class="col-3 col-2-md text-right">Depictions:</label>
            <input type="number" deer-key-todo="depiction" placeholder="0" class="col-9 col-4-md">
            <label class="col-3 col-2-md text-right">Language</label>
            <input type="text" deer-key="language" placeholder="0-1" class="col-9 col-4-md">

            <!-- This is the text selected from each line combined together, as plain text -->
            <label class="col-3 col-2-md text-right">Text:</label>
            <textarea deer-key="text" rows="2" class="col-9 col-10-md"></textarea>

            <label class="col-3 col-2-md text-right">Other Metadata:</label>
            <textarea deer-key-todo="metadata" rows="2" class="col-9 col-10-md"></textarea>
            <!-- selections is an array of TPEN Line URIs with #char fragmet selectors -->
            <input type="hidden" deer-key="selections" />
            <!-- references is an array of Named Glosses -->
            <input type="hidden" deer-key="references" />
        </div>

        <!-- When lines are selected, a #char Fragment URI is generated.  The 'Text' needs to know those line URIs. -->
        <tpen-line-selector class="lineSelector needed is-hidden row"> </tpen-line-selector>

        <!-- A single NamedGloss is selected.  The 'Text' needs to know that Named Gloss URI. -->
        <deer-view class="needed is-hidden" id="ngCollectionList" deer-listing="" public-collection="https://store.rerum.io/v1/id/610c54deffce846a83e70625" deer-collection="Glossing-Matthew-Named-Glosses" deer-link="ng.html#" deer-template="glossesSelectorForTextualWitness">
        Loading&hellip;
        </deer-view>  

        <!-- If the user does not find a Named Gloss for the text selection, they can create a new one instead.  The 'Text' needs to know the resulting Named Gloss URI. -->
        <form id="ngForm" deer-type="named-gloss" deer-context="http://www.loc.gov/mods" class="row is-hidden">
            <input type="text" deer-key="title" placeholder="Display Label" class="col">
            <input type="hidden" deer-key="targetCollection" value="Glossing-Matthew-Named-Glosses">
            <input is="auth-creator" type="hidden" deer-key="creator" />
            <input type="submit" value="Add NG : Title Only" class="col">
        </form>     

        <input type="submit" value="Create Textual Witness"/>
    </deer-form>

    
    <!-- <tpen-line-selector class="lineSelector row"> </tpen-line-selector> -->

    
    <!-- <named-glosses-selector class="ngSelector row"> </named-glosses-selector> -->
    <gog-footer class="row"></gog-footer>

    <div id="globalFeedback" class="card is-center"></div>
    <script>

        // We will know the TPEN project for the page.  There should be only one.
        // We may know a Named Gloss ID for the page.  However, it is more likely the user is hoping to match on one per gloss of text, perhaps over multiple lines and/or pages.

        window.onhashchange = onload = () => {
            const tpenID = getURLParameter("tpen-project")
            if(tpenID) {
                needs.classList.add("is-hidden")
                document.querySelectorAll(".needed").forEach(el => el.classList.remove("is-hidden"))
            }
            // It is possible we could also let them hand in a Named Gloss URI as well.
            const textWitnessID = window.location.hash.substr(1)
            document.querySelector(".lineSelector").setAttribute("tpen-project", tpenID)
            document.querySelector("deer-form").setAttribute("deer-id", textWitnessID)
        }

        function loadURI(){
            let url = resourceURI.value ? resourceURI.value : getURLParameter("tpen-project")
            if(url){
                let tpen = "?tpen-project="+url
                url = window.location.href.split('?')[0] + tpen
                window.location = url
            }
            else{
                alert("You must supply a URI via the IIIF Content State iiif-content parameter or supply a value in the text input.")
            }
        }

    </script>
</body>

</html>